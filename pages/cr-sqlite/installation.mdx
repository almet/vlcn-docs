import { Callout } from "nextra-theme-docs";
import { Tab, Tabs } from "nextra-theme-docs";

# Installation

cr-sqlite is distributed as a [run time loadable extension](https://www.sqlite.org/loadext.html) for SQLite and can be used with any language that has SQLite bindings.

<Callout emoji="ðŸ‘¾">
  If you intend to write or create conflict free tables (CRRs) from a connection
  you _must_ load the cr-sqlite extension into that connection before
  interacting with any CRRs. Connections that only read CRRs do not require
  loading the extension.
</Callout>

## Acquiring the extension

**Pre-built binaries** - You can download a pre-built binary for your platform from [GitHub releases](https://github.com/vlcn-io/cr-sqlite/releases).

**Building from source** - You may also build from source by cloning the [cr-sqlite repository](https://github.com/vlcn-io/cr-sqlite) and following the instructions in the readme.

**Packages**

1. NodeJS & Deno - see [docs/nodejs](../js/nodejs)
2. Browser/WASM - see [docs/wasm](../js/wasm)

## Loading the extension

Once you've acquired the extension you'll need to load it into your SQLite connection. This is done by calling the `sqlite3_load_extension` function with the path to the extension and the name of the extension.


<Callout emoji="ðŸ‘¾">
  If you downloaded a prebuilt binary you should rename it to `crsqlite.[dll/so/dylib]`. This name follows SQLite's expected naming conventions for extensions. Otherwise you need to pass `sqlite3_crsqlite_init` as [an argument to `sqlite3_load_extension`](https://www.sqlite.org/c3ref/load_extension.html).
</Callout>

Examples:

<Tabs items={["python", "C", "CLI", "Rust", "NodeJS", "Web Browser"]}>
  <Tab>
    ```python
    import sqlite3
    conn = sqlite3.connect(db_file)
    c.enable_load_extension(True)
    conn.load_extension('path/to/crsqlite')
    ```
  </Tab>
  <Tab>
    ```c
    sqlite3 *db;
    sqlite3_open("my_database.db", &db);
    
    // Load the extension
    sqlite3_enable_load_extension(db, 1);
    sqlite3_load_extension(db, "/path/to/crsqlite", "sqlite3_crsqlite_init", NULL);
    ```
  </Tab>
  <Tab>
  ```bash
  > sqlite3
  sqlite> .load /path/to/crsqlite sqlite3_crsqlite_init
  ```
  </Tab>
  <Tab>
  ```rust
  use rusqlite::{Connection, Result};
  let conn = Connection::open("my_database.db")?;
  unsafe {
    conn.load_extension_enable()?;
    let r = conn.load_extension("/path/to/crsqlite", Some("sqlite3_crsqlite_init"))?;
    conn.load_extension_disable()?;1
    r
  }
  ```
  </Tab>
  <Tab>
  ```js
  import SQLiteDB from "better-sqlite3";
  import { extensionPath } from "@vlcn.io/crsqlite";
  db = new SQLiteDB("my_database.db");
  db.loadExtension(extensionPath);
  ```
  </Tab>
  <Tab>
  ```js
  const initWasm = await import('https://esm.sh/@vlcn.io/crsqlite-wasm@0.9.1');
  const sqlite = await initWasm.default(() => "https://esm.sh/@vlcn.io/crsqlite-wasm@0.9.1/dist/crsqlite.wasm");
  const db1 = await sqlite.open("my_database.db");
  // the extension is statically linked into the wasm build. no need to load it explicitly.
  ```
  </Tab>
</Tabs>

## Closing Connections & Freeing the Extension